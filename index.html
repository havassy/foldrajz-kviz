<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√©gk√∂r √©s v√≠z kv√≠z</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

<div id="app"></div>

<script>
// ============================================
// KONFIGUR√ÅCI√ì - 10 API KULCS ROT√ÅL√ÅS
// ============================================

const API_KEYS = [
    'AIzaSyBWBao-YGhyhxgBmv074kluPV-wSKHS9O0',
    'AIzaSyA5GE6tNFlnvDL1WGRxdZUZBh72AjdawLI',
    'AIzaSyCVnMJVryCtS0nhOLRT-dPAg2398ZD3Yng',
    'AIzaSyAJeVCjb30GalxKamTUYel9tuIDbtN-lMY',
    'AIzaSyDTO49EDdMyk9T2a59E-JHOGzpuXSsp1M4',
    'AIzaSyBZ7xrPCsjiI8XgHyR_5ZRQfICqCU2XYpM',
    'AIzaSyC1K6-LzrIWAua05MonDB1kQXf3YN4FOYk',
    'AIzaSyBGYH4lTfht_maEGNKS873cEXDTpuKAmT8',
    'AIzaSyAQXjMwS_M0LoRfanhHmgdtWW031Nm2p_4',
    'AIzaSyAwACYYmSJuGxFhVCRvdMAOLWL_FA8T4Rk'
];

let currentKeyIndex = 0;
let keyUsageCount = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

function getNextApiKey() {
    const key = API_KEYS[currentKeyIndex];
    keyUsageCount[currentKeyIndex]++;
    const usedIndex = currentKeyIndex;
    currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length;
    console.log(`üîë API Kulcs #${usedIndex + 1} haszn√°lva (${keyUsageCount[usedIndex]}. alkalommal)`);
    return key;
}

const MODELS_TO_TRY = ['gemini-2.5-flash'];
let WORKING_MODEL = null;

const WEATHER_EMOJIS = ['‚òÄÔ∏è', '‚õÖ', '‚òÅÔ∏è', 'üå§Ô∏è', '‚õàÔ∏è', 'üåà', '‚ùÑÔ∏è', 'üåü', '‚≠ê', '‚ú®'];

// ============================================
// ALKALMAZ√ÅS LOGIKA
// ============================================
let appState = {
    mode: 'tanulas',
    isSetupComplete: false,
    questions: [],
    filteredQuestions: [],
    
    currentQuestion: null,
    userAnswer: '',
    evaluation: null,
    selectedTopic: 'mind',
    selectedDifficulty: 'mind',
    topics: [],
    difficulties: [],
    hintsUsed: 0,
    revealedKeywords: [],
    askedQuestionIds: [],
    
    testQuestions: [],
    testAnswers: [],
    currentTestIndex: 0,
    testCompleted: false,
    testScore: 0,
    testUserName: '',
    certificateDownloaded: false,
    
    isLoading: false,
    errorMessage: '',
    totalAsked: 0
};

// CSV parsing
function parseCSVText(text) {
    const lines = text.trim().split('\n');
    if (lines.length < 2) return [];

    const loadedQuestions = [];
    let delimiter = ',';
    if (lines[0].includes('\t')) {
        delimiter = '\t';
    } else if (lines[0].includes(';')) {
        delimiter = ';';
    }
    
    const delimiterName = delimiter === '\t' ? 'TAB' : delimiter === ';' ? 'PONTOSVESSZ≈ê' : 'VESSZ≈ê';
    console.log(`üìÑ CSV elv√°laszt√≥: ${delimiterName}`);
    
    for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(delimiter);
        if (values.length >= 3) {
            loadedQuestions.push({
                id: i,
                question: values[0]?.trim() || '',
                sampleAnswer: values[1]?.trim() || '',
                keywords: values[2]?.trim() || '',
                commonMistakes: values[3]?.trim() || '',
                topic: values[4]?.trim() || '√Åltal√°nos',
                difficulty: values[5]?.trim() || 'K√∂zepes'
            });
        }
    }
    
    return loadedQuestions.filter(q => q.question !== '');
}

// CSV bet√∂lt√©s
async function loadQuestionsFromCSV() {
    try {
        appState.isLoading = true;
        appState.errorMessage = '';
        render();
        
        const response = await fetch('ai3.csv');
        if (!response.ok) {
            throw new Error('CSV f√°jl nem tal√°lhat√≥!');
        }
        
        const csvText = await response.text();
        const parsed = parseCSVText(csvText);
        
        if (parsed.length === 0) {
            throw new Error('Nem siker√ºlt k√©rd√©seket beolvasni!');
        }
        
        appState.questions = parsed;
        appState.topics = [...new Set(parsed.map(q => q.topic))];
        appState.difficulties = [...new Set(parsed.map(q => q.difficulty))];
        appState.isLoading = false;
        appState.isSetupComplete = true;
        
        console.log(`‚úÖ ${parsed.length} k√©rd√©s bet√∂ltve!`);
        
        selectRandomQuestion();
        
    } catch (error) {
        console.error('CSV bet√∂lt√©si hiba:', error);
        appState.errorMessage = `Hiba: ${error.message}`;
        appState.isLoading = false;
        render();
    }
}

// ============================================
// TANUL√ÅS M√ìD FUNKCI√ìK
// ============================================

function selectRandomQuestion() {
    const filtered = filterQuestions();
    if (filtered.length === 0) return;
    
    const unanswered = filtered.filter(q => !appState.askedQuestionIds.includes(q.id));
    
    if (unanswered.length === 0) {
        appState.askedQuestionIds = [];
        appState.errorMessage = 'üéâ V√©gigment√©l az √∂sszes k√©rd√©sen!';
        setTimeout(() => {
            appState.errorMessage = '';
            selectRandomQuestion();
        }, 2000);
        render();
        return;
    }
    
    const randomIndex = Math.floor(Math.random() * unanswered.length);
    appState.currentQuestion = unanswered[randomIndex];
    appState.askedQuestionIds.push(appState.currentQuestion.id);
    
    appState.userAnswer = '';
    appState.evaluation = null;
    appState.errorMessage = '';
    appState.hintsUsed = 0;
    appState.revealedKeywords = [];
    
    render();
}

function requestHint() {
    if (!appState.currentQuestion || !appState.currentQuestion.keywords) return;
    
    const allKeywords = appState.currentQuestion.keywords.split(',').map(k => k.trim());
    const unrevealed = allKeywords.filter(k => !appState.revealedKeywords.includes(k));
    
    if (unrevealed.length === 0) {
        appState.errorMessage = '‚ö†Ô∏è Nincs t√∂bb megjelen√≠thet≈ë seg√≠ts√©g!';
        render();
        return;
    }
    
    const randomKeyword = unrevealed[Math.floor(Math.random() * unrevealed.length)];
    appState.revealedKeywords.push(randomKeyword);
    appState.hintsUsed++;
    appState.errorMessage = '';
    render();
}

function filterQuestions() {
    let filtered = appState.questions;
    
    if (appState.selectedTopic !== 'mind') {
        filtered = filtered.filter(q => q.topic === appState.selectedTopic);
    }
    
    if (appState.selectedDifficulty !== 'mind') {
        filtered = filtered.filter(q => q.difficulty === appState.selectedDifficulty);
    }
    
    appState.filteredQuestions = filtered;
    return filtered;
}

function changeFilter(type, value) {
    if (type === 'topic') {
        appState.selectedTopic = value;
    } else if (type === 'difficulty') {
        appState.selectedDifficulty = value;
    }
    
    appState.askedQuestionIds = [];
    appState.evaluation = null;
    filterQuestions();
    selectRandomQuestion();
}

// ============================================
// TESZT M√ìD FUNKCI√ìK
// ============================================

function startTest() {
    const shuffled = [...appState.questions].sort(() => Math.random() - 0.5);
    appState.testQuestions = shuffled.slice(0, 5);
    appState.testAnswers = [];
    appState.currentTestIndex = 0;
    appState.testCompleted = false;
    appState.testScore = 0;
    appState.userAnswer = '';
    appState.evaluation = null;
    appState.hintsUsed = 0;
    appState.revealedKeywords = [];
    appState.certificateDownloaded = false;
    render();
}

function requestTestHint() {
    const currentQ = appState.testQuestions[appState.currentTestIndex];
    if (!currentQ || !currentQ.keywords) return;
    
    const allKeywords = currentQ.keywords.split(',').map(k => k.trim());
    const unrevealed = allKeywords.filter(k => !appState.revealedKeywords.includes(k));
    
    if (unrevealed.length === 0) {
        appState.errorMessage = '‚ö†Ô∏è Nincs t√∂bb megjelen√≠thet≈ë seg√≠ts√©g!';
        render();
        return;
    }
    
    const randomKeyword = unrevealed[Math.floor(Math.random() * unrevealed.length)];
    appState.revealedKeywords.push(randomKeyword);
    appState.hintsUsed++;
    appState.errorMessage = '';
    render();
}

async function submitTestAnswer() {
    if (!appState.userAnswer.trim()) {
        appState.errorMessage = 'K√©rlek, √≠rj be egy v√°laszt!';
        render();
        return;
    }
    
    const currentQ = appState.testQuestions[appState.currentTestIndex];
    
    appState.isLoading = true;
    render();
    
    const evaluation = await evaluateAnswerAPI(currentQ, appState.userAnswer, appState.hintsUsed);
    
    appState.testAnswers.push({
        question: currentQ,
        userAnswer: appState.userAnswer,
        evaluation: evaluation,
        hintsUsed: appState.hintsUsed
    });
    
    appState.isLoading = false;
    appState.evaluation = evaluation;
    render();
}

function nextTestQuestion() {
    appState.currentTestIndex++;
    
    if (appState.currentTestIndex >= appState.testQuestions.length) {
        completeTest();
    } else {
        appState.userAnswer = '';
        appState.evaluation = null;
        appState.hintsUsed = 0;
        appState.revealedKeywords = [];
        appState.errorMessage = '';
        render();
    }
}

function completeTest() {
    const totalPoints = appState.testAnswers.reduce((sum, ans) => sum + ans.evaluation.pontszam, 0);
    const maxPoints = appState.testAnswers.length * 10;
    appState.testScore = Math.round((totalPoints / maxPoints) * 100);
    appState.testCompleted = true;
    appState.evaluation = null;
    render();
}

function generateCertificate() {
    if (appState.certificateDownloaded) {
        return; // M√°r let√∂ltve, ne engedj√ºk √∫jra
    }
    
    const userName = appState.testUserName.trim() || 'N√©vtelen';
    const score = appState.testScore;
    const emoji = WEATHER_EMOJIS[Math.floor(Math.random() * WEATHER_EMOJIS.length)];
    
    const now = new Date();
    const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
    
    const canvas = document.createElement('canvas');
    canvas.width = 800;
    canvas.height = 600;
    const ctx = canvas.getContext('2d');
    
    const gradient = ctx.createLinearGradient(0, 0, 0, 600);
    gradient.addColorStop(0, '#EBF4FF');
    gradient.addColorStop(1, '#C3DAFE');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 800, 600);
    
    ctx.strokeStyle = '#4F46E5';
    ctx.lineWidth = 8;
    ctx.strokeRect(20, 20, 760, 560);
    
    ctx.strokeStyle = '#6366F1';
    ctx.lineWidth = 2;
    ctx.strokeRect(40, 40, 720, 520);
    
    ctx.font = 'bold 80px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(emoji, 400, 120);
    
    ctx.font = 'bold 48px Arial';
    ctx.fillStyle = '#1E293B';
    ctx.fillText('TAN√öS√çTV√ÅNY', 400, 200);
    
    ctx.font = 'bold 36px Arial';
    ctx.fillStyle = '#334155';
    ctx.fillText(userName, 400, 260);
    
    ctx.font = '28px Arial';
    ctx.fillStyle = '#475569';
    ctx.fillText('A l√©gk√∂r tesztet', 400, 320);
    
    ctx.font = 'bold 56px Arial';
    ctx.fillStyle = score >= 90 ? '#059669' : '#DC2626';
    ctx.fillText(`${score}%`, 400, 390);
    
    ctx.font = '28px Arial';
    ctx.fillStyle = '#475569';
    ctx.fillText('eredm√©nnyel v√©gezte el.', 400, 440);
    
    ctx.font = '18px Arial';
    ctx.fillStyle = '#64748B';
    ctx.fillText(timestamp, 400, 520);
    
    ctx.fillStyle = '#4F46E5';
    ctx.fillRect(200, 540, 400, 4);
    
    canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `legkor_tanusitvany_${userName}_${score}%.png`;
        a.click();
        URL.revokeObjectURL(url);
        
        // Let√∂lt√©s ut√°n
        appState.certificateDownloaded = true;
        render();
    }, 'image/png');
}

// ============================================
// M√ìD V√ÅLT√ÅS
// ============================================

function switchMode(newMode) {
    appState.mode = newMode;
    
    if (newMode === 'teszt') {
        startTest();
    } else {
        appState.testCompleted = false;
        appState.userAnswer = '';
        appState.evaluation = null;
        appState.hintsUsed = 0;
        appState.revealedKeywords = [];
        appState.askedQuestionIds = [];
        selectRandomQuestion();
    }
}

// ============================================
// √âRT√âKEL√âS API - TOV√ÅBBFEJLESZTETT
// ============================================

async function evaluateAnswer() {
    if (!appState.userAnswer.trim()) {
        appState.errorMessage = 'K√©rlek, √≠rj be egy v√°laszt!';
        render();
        return;
    }

    appState.isLoading = true;
    appState.errorMessage = '';
    render();
    
    const evaluation = await evaluateAnswerAPI(
        appState.currentQuestion,
        appState.userAnswer,
        appState.hintsUsed
    );
    
    appState.evaluation = evaluation;
    appState.isLoading = false;
    appState.totalAsked++;
    render();
}

async function evaluateAnswerAPI(question, userAnswer, hintsUsed) {
    const prompt = `Te egy seg√≠t≈ëk√©sz f√∂ldrajz tan√°r vagy, aki di√°kok v√°laszait √©rt√©keli.

K√âRD√âS: ${question.question}

MINTAV√ÅLASZ (referencia): ${question.sampleAnswer}

‚ö†Ô∏è KRITIKUS SZAB√ÅLYOK A MINTAV√ÅLASZR√ìL:
- A mintav√°lasz HELYES √©s alapvet≈ë referencia!
- DE nem az egyetlen helyes v√°lasz - l√©gy rugalmas!
- Ha a di√°k m√°s helyes v√°laszt ad (faktikusan igaz) ‚Üí FOGADD EL!
- DE SOHA ne c√°fold vagy b√≠r√°ld fel√ºl a mintav√°laszt!
- Ha a di√°k hib√°t √≠r, haszn√°ld a mintav√°lasz inform√°ci√≥it a jav√≠t√°shoz!

‚ö†Ô∏è TILOS A VISSZAJELZ√âSBEN:
- "mintav√°lasz" sz√≥ haszn√°lata
- "helyes v√°lasz szerint..."
- "ahogy a v√°laszban szerepel..."
- "a v√°lasz mutatja..."
- B√°rmilyen utal√°s a mintav√°laszra!

‚úÖ HELYETTE haszn√°ld:
- "Val√≥j√°ban..."
- "A pontos magyar√°zat..."
- Vagy kezdj K√ñZVETLEN√úL a tartalommal, mintha te magyar√°zn√°d!

K√ñTELEZ≈ê KULCSSZAVAK/FOGALMAK: ${question.keywords}

${question.commonMistakes ? `
TIPIKUS HIB√ÅK/T√âVHITEK (ha a di√°k ezeket √≠rja, M√âRLEGELJ 2-8 pont k√∂z√∂tt):
${question.commonMistakes}
` : ''}

DI√ÅK V√ÅLASZA: ${userAnswer}

‚ö†Ô∏è NE √çRD BE A TELJES REFERENCIA V√ÅLASZT!
- Csak a HI√ÅNYZ√ì KULCSFOGALMAKAT eml√≠tsd!

SZIGOR√ö PONTOZ√ÅSI SZAB√ÅLYOK:

‚ö†Ô∏è KRITIKUS SZAB√ÅLY - 10 PONT AD√ÅS√ÅNAK FELT√âTELE:
Ha a v√°lasz:
- Tartalmilag HELYES (nincs t√©ved√©s, t√©vhit)
- R√âSZLETES, KIFEJTETT MONDATOKBAN megfogalmazva
- Minden KULCSSZ√ì megvan (vagy szinonim√°ja)
- Ha a mintav√°lasz/kulcsszavak tartalmaznak P√âLD√ÅKAT ‚Üí a di√°k is √≠rt p√©ld√°t
‚Üí AKKOR K√ñTELEZ≈ê 10 PONTOT ADNI!

HA 9 VAGY KEVESEBB PONTOT AKARSZ ADNI:
‚Üí A "hianyossagok" MEZ≈êBEN K√ñTELEZ≈ê MINDEN HI√ÅNYOSS√ÅGOT R√âSZLETESEN MEGNEVEZNI!
‚Üí Adj KONKR√âT JAVASLATOT, hogyan jav√≠thatja a v√°laszt!

1. MONDAT √âS R√âSZLETESS√âG K√ñVETELM√âNYE:

   ‚ö†Ô∏è √ÅLTAL√ÅNOS SZAB√ÅLY: MINDIG KELL R√âSZLETES, KIFEJTETT V√ÅLASZ MONDATBAN!
   
   KIV√âTELEK (ahol felsorol√°s is elfogadhat√≥):
   - "Sorold fel..."
   - "Melyek..." (ha csak list√°t k√©r)
   - "Milyen t√≠pusai vannak..."
   
   MINDEN M√ÅS K√âRD√âSN√âL K√ñTELEZ≈ê A MONDAT!
   
   PONTOZ√ÅS:
   A) √ârthet≈ë felsorol√°s van, DE nincs teljes kifejt≈ë mondat:
      ‚Üí ‚àí1 pont
      ‚Üí "hianyossagok": "V√°laszolj r√©szletesebben, teljes mondatokban! P√©ld√°ul: '...'"
   
   B) Felsorol√°s NEM √©rthet≈ë / kaotikus / neh√©z k√∂vetni a tartalmat:
      ‚Üí ‚àí2 pont
      ‚Üí "hianyossagok": "A v√°laszod nehezen k√∂vethet≈ë. Fogalmazd mondatban √≠gy: '...'"
   
   C) T√∫l r√∂vid v√°lasz (1-3 sz√≥), felsz√≠nes:
      ‚Üí ‚àí2 pont
      ‚Üí "hianyossagok": "V√°laszolj r√©szletesebben √©s pontosabban! P√©ld√°ul: '...'"

2. P√âLDA K√ñVETELM√âNY:

   ‚ö†Ô∏è ELLEN≈êRIZD: Van-e P√âLDA a MINTAV√ÅLASZBAN vagy KULCSSZAVAKBAN?
   
   P√©lda felismer√©si jelek:
   - Z√°r√≥jelben: "kondenz√°ci√≥s magok (por, s√≥, f√ºst)"
   - "pl.", "p√©ld√°ul", "mint" szavak ut√°n
   - Felsorolva: "oxig√©n, nitrog√©n, arg√≥n"
   
   Ha VAN P√âLDA a mint√°ban/kulcsszavakban:
   ‚Üí A di√°knak is KELL p√©ld√°t √≠rnia!
   ‚Üí Ha a di√°k √çR LEGAL√ÅBB 1 HELYES P√âLD√ÅT ‚Üí elfogadjuk, NINCS pontlevon√°s!
   ‚Üí Ha EGY√ÅLTAL√ÅN NINCS p√©lda a di√°k v√°lasz√°ban: ‚àí1 pont/p√©lda kateg√≥ria
   ‚Üí "hianyossagok": "√çrj p√©ld√°t is a 'XY' fogalomra! P√©ld√°ul: [konkr√©t p√©lda]."

3. KULCSSZAVAK HI√ÅNYOSS√ÅGA:
   
   Kulcsszavak list√°ja: ${question.keywords}
   
   - Ha MINDEN kulcssz√≥ megvan (vagy szinonim√°ja): +0 pont (rendben)
   - Ha HI√ÅNYZIK kulcssz√≥(k), DE tartalmilag helyes: ‚àí2 pont √∂sszesen!
   - "hianyossagok": "K√∂vetkez≈ë alkalommal haszn√°ld a 'XY' szaksz√≥t, √©s √≠rj p√©ld√°t is, pl. [konkr√©t p√©lda]."

4. TARTALMI HIB√ÅK (PRIORIT√ÅS!):
   - Ha a v√°lasz tartalmilag HIB√ÅS, t√©ves, vagy t√©vhitet tartalmaz: MAXIMUM 2-3 pont!
${question.commonMistakes ? `   - Ha a di√°k a fenti tipikus hib√°k/t√©vhitek valamelyik√©t √≠rta: M√âRLEGELJ 2-8 pont k√∂z√∂tt!
   - Ha a tipikus hiba S√öLYOS √©s a v√°lasz nagy r√©sze helytelen: 2-3 pont
   - Ha a tipikus hiba kis r√©sze a v√°lasznak, de van helyes r√©sz is: 5-8 pont` : ''}
   
5. R√âSZBEN HELYES V√ÅLASZ ESET√âN:
   - El≈ësz√∂r DICS√âRD MEG, mi volt j√≥!
   - Majd PONTOSAN mondd meg, mi HI√ÅNYZIK!
   - Adj KONKR√âT p√©ld√°t, hogyan kellett volna!
   - P√©lda: "A v√°laszod r√©szben helyes - a ciklonok val√≥ban es≈ët hoznak! DE hi√°nyzik az anticiklonok eml√≠t√©se, amik sz√°raz, der√ºlt id≈ët okoznak. K√∂vetkez≈ë alkalommal fogalmazd √≠gy: 'A ciklonok es≈ës id≈ët, m√≠g az anticiklonok der√ºlt id≈ëj√°r√°st hoznak.'"

6. "NEM TUDOM" VAGY √úRES V√ÅLASZ:
   - "Nem tudom" vagy hasonl√≥: 0 pont!

‚ö†Ô∏è KRITIKUS: MINDEN HI√ÅNYOSS√ÅGOT R√âSZLETESEN INDOKOLJ!
- Ha mondat hi√°nyzik ‚Üí √≠rj javaslatot, hogyan fogalmazza mondatban!
- Ha p√©lda hi√°nyzik ‚Üí adj konkr√©t p√©ld√°t!
- Ha kulcssz√≥ hi√°nyzik ‚Üí mondd meg, melyik √©s adj p√©ld√°t!
- Ha r√©szletess√©g hi√°nyzik ‚Üí mutass p√©ld√°t r√©szletes v√°laszra!

‚ö†Ô∏è FONTOS: A "pontszam" mez≈ëben az AI √°ltal sz√°m√≠tott pontsz√°mot add meg!
A seg√≠ts√©g b√ºntet√©st (-${hintsUsed * 2} pont) NEM az AI sz√°molja, hanem a program!

V√°laszolj az al√°bbi JSON form√°tumban (CSAK JSON-t √≠rj, semmi m√°st):
{
  "pontszam": (0 √©s 10 k√∂z√∂tt),
  "visszajelzes": "Megfogalmaztad... (SOHA ne haszn√°ld: 'mintav√°lasz', 'helyes v√°lasz szerint', stb.)",
  "hianyossagok": ["MINDEN hi√°nyoss√°got r√©szletesen, konkr√©t javaslattal!"],
  "dicseret": "..."
}`;

    let lastError = null;
    
    for (const model of MODELS_TO_TRY) {
        try {
            console.log(`üîÑ Pr√≥b√°lom: ${model}...`);
            const result = await tryModel(model, prompt);
            WORKING_MODEL = model;
            console.log(`‚úÖ M≈±k√∂dik: ${model}`);
            
            // POST-PROCESSING: Szab√°lyok kik√©nyszer√≠t√©se
            const processedResult = postProcessEvaluation(result, hintsUsed);
            
            return processedResult;
        } catch (error) {
            console.log(`‚ùå Nem m≈±k√∂dik: ${model} - ${error.message}`);
            lastError = error;
            continue;
        }
    }

    throw new Error('√ârt√©kel√©si hiba!');
}

// ============================================
// POST-PROCESSING - SZAB√ÅLYOK KIK√âNYSZER√çT√âSE
// ============================================

function postProcessEvaluation(evaluation, hintsUsed) {
    console.log('üîß Post-processing kezd√©s:', evaluation);
    
    // 1. Seg√≠ts√©g levon√°s (k√≥dban, biztosan m≈±k√∂dik)
    let finalScore = evaluation.pontszam - (hintsUsed * 2);
    
    // 2. Minimum 0 pont
    finalScore = Math.max(0, finalScore);
    
    // 3. Maximum 10 pont
    finalScore = Math.min(10, finalScore);
    
    // 4. Seg√≠ts√©g haszn√°lat kezel√©se a hi√°nyoss√°gokban
    if (hintsUsed > 0 && evaluation.pontszam === 10) {
        // CSAK seg√≠ts√©g miatt vesz√≠tett pontot, m√°s hiba nincs
        evaluation.hianyossagok = [
            "K√∂vetkez≈ë alkalommal pr√≥b√°lj seg√≠ts√©g n√©lk√ºl v√°laszolni!"
        ];
    } else if (hintsUsed > 0 && evaluation.pontszam < 10) {
        // Seg√≠ts√©get k√©rt √âS m√°s hiba is volt
        if (!evaluation.hianyossagok || evaluation.hianyossagok.length === 0) {
            evaluation.hianyossagok = [];
        }
        // Adjuk hozz√° a seg√≠ts√©g figyelmeztet√©st az els≈ë helyre
        evaluation.hianyossagok.unshift(
            "K√∂vetkez≈ë alkalommal pr√≥b√°lj seg√≠ts√©g n√©lk√ºl v√°laszolni!"
        );
    }
    
    // 5. Ha 10 pont √âS van hi√°nyoss√°g ‚Üí automatikusan 9 pont
    if (finalScore === 10 && 
        evaluation.hianyossagok && 
        evaluation.hianyossagok.length > 0 && 
        evaluation.hianyossagok[0] !== "") {
        
        console.warn('‚ö†Ô∏è AI konzisztencia hiba jav√≠tva: 10‚Üí9 pont (van hi√°nyoss√°g)');
        finalScore = 9;
    }
    
    // 6. Ha <10 pont, de nincs hi√°nyoss√°g megadva ‚Üí k√∂telez≈ë magyar√°zat
    if (finalScore < 10 && 
        (!evaluation.hianyossagok || evaluation.hianyossagok.length === 0 || evaluation.hianyossagok[0] === "")) {
        
        console.warn('‚ö†Ô∏è Hi√°nyz√≥ magyar√°zat p√≥tl√°sa');
        evaluation.hianyossagok = ["V√°laszolj r√©szletesebben √©s pontosabban!"];
    }
    
    // 7. Ha 0 pont, ne legyen dics√©r≈ë visszajelz√©s
    if (finalScore === 0 && evaluation.dicseret) {
        evaluation.dicseret = "";
    }
    
    // 8. Seg√≠ts√©g inform√°ci√≥ hozz√°ad√°sa a visszajelz√©shez
    if (hintsUsed > 0) {
        evaluation.visszajelzes += ` (Seg√≠ts√©g haszn√°lat: -${hintsUsed * 2} pont)`;
    }
    
    evaluation.pontszam = finalScore;
    
    console.log('‚úÖ Post-processing befejezve:', evaluation);
    
    return evaluation;
}

async function tryModel(modelName, prompt) {
    const apiKey = getNextApiKey();
    
    const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`,
        {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                generationConfig: {
                    temperature: 0.1,
                    topP: 0.8,
                    topK: 40
                }
            })
        }
    );

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`${response.status}: ${errorData.error?.message || 'Ismeretlen hiba'}`);
    }

    const data = await response.json();
    let responseText = data.candidates[0].content.parts[0].text;
    responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
    
    return JSON.parse(responseText);
}

// ============================================
// RENDEREL√âS
// ============================================

function render() {
    const app = document.getElementById('app');
    
    if (!appState.isSetupComplete) {
        app.innerHTML = renderSetup();
    } else {
        if (appState.mode === 'tanulas') {
            app.innerHTML = renderLearningMode();
        } else {
            app.innerHTML = renderTestMode();
        }
    }
}

function renderSetup() {
    return `
        <div class="min-h-screen p-6 flex items-center justify-center">
            <div class="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <h1 class="text-3xl font-bold text-gray-800">F√∂ldrajz Kv√≠z</h1>
                </div>

                ${appState.isLoading ? `
                <div class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                    <p class="mt-4 text-gray-600">K√©rd√©sek bet√∂lt√©se...</p>
                </div>
                ` : ''}

                ${appState.errorMessage ? `
                <div class="mb-6 p-4 bg-red-50 border-2 border-red-300 rounded-xl">
                    <h3 class="font-bold text-red-800 mb-2">‚ùå Hiba:</h3>
                    <p class="text-sm text-red-700 whitespace-pre-wrap">${appState.errorMessage}</p>
                </div>
                ` : ''}
                
                <div class="text-center">
                    <p class="text-gray-600">K√©rd√©sek bet√∂lt√©se folyamatban...</p>
                </div>
            </div>
        </div>
    `;
}

function renderLearningMode() {
    const q = appState.currentQuestion;
    if (!q) return '<div class="p-6">Bet√∂lt√©s...</div>';
    
    return `
        <div class="min-h-screen p-6">
            <div class="max-w-3xl mx-auto">
                <!-- M√≥d v√°lt√≥ gombok -->
                <div class="mb-4 flex gap-3">
                    <button
                        onclick="switchMode('tanulas')"
                        class="flex-1 bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl"
                    >
                        üìö Tanul√°s m√≥d
                    </button>
                    <button
                        onclick="switchMode('teszt')"
                        class="flex-1 bg-white text-indigo-600 border-2 border-indigo-600 font-semibold py-3 px-6 rounded-xl hover:bg-indigo-50"
                    >
                        üéØ Teszt m√≥d
                    </button>
                </div>

                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <!-- Fejl√©c -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <svg class="w-10 h-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Tanul√°s m√≥d</h1>
                                    <p class="text-sm text-gray-500">
                                        ${appState.askedQuestionIds.length}/${appState.filteredQuestions.length} k√©rd√©s
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress bar -->
                        ${appState.filteredQuestions.length > 0 ? `
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 h-3 rounded-full transition-all duration-500" 
                                 style="width: ${Math.round(appState.askedQuestionIds.length / appState.filteredQuestions.length * 100)}%">
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- K√©rd√©s -->
                    <div class="bg-indigo-50 rounded-xl p-6 mb-6">
                        <div class="flex justify-between items-start mb-3">
                            <h2 class="text-xl font-semibold text-indigo-900">K√©rd√©s:</h2>
                            <div class="flex gap-2">
                                <span class="text-xs bg-indigo-200 text-indigo-800 px-3 py-1 rounded-full">${q.topic}</span>
                                <span class="text-xs bg-purple-200 text-purple-800 px-3 py-1 rounded-full">${q.difficulty}</span>
                            </div>
                        </div>
                        <p class="text-lg text-gray-700">${q.question}</p>
                        <p class="text-xs text-amber-600 mt-3 font-medium">
                            ‚ö†Ô∏è Ha a k√©rd√©s magyar√°zatot k√©r, v√°laszolj teljes mondatokban!
                        </p>
                        
                        ${appState.revealedKeywords.length > 0 ? `
                        <div class="mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg">
                            <p class="text-sm font-semibold text-yellow-900 mb-1">üí° Seg√≠ts√©g (-${appState.hintsUsed * 2} pont):</p>
                            <p class="text-sm text-yellow-800">${appState.revealedKeywords.join(', ')}</p>
                        </div>
                        ` : ''}
                    </div>

                    ${!appState.evaluation ? `
                    <!-- V√°lasz mez≈ë -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">A te v√°laszod:</label>
                        <textarea
                            id="userAnswerInput"
                            oninput="appState.userAnswer = this.value"
                            class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:outline-none resize-none"
                            placeholder="√çrd ide a v√°laszodat..."
                            ${appState.isLoading ? 'disabled' : ''}
                        >${appState.userAnswer}</textarea>
                    </div>

                    <!-- Gombok -->
                    <div class="flex gap-3 mb-4">
                        <button
                            onclick="evaluateAnswer()"
                            ${appState.isLoading ? 'disabled' : ''}
                            class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors disabled:bg-gray-400"
                        >
                            ${appState.isLoading ? '√ârt√©kel√©s...' : 'V√°lasz √©rt√©kel√©se'}
                        </button>
                        <button
                            onclick="requestHint()"
                            ${appState.isLoading ? 'disabled' : ''}
                            class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors disabled:bg-gray-400"
                        >
                            üí° Seg√≠ts√©g
                        </button>
                        <button
                            onclick="selectRandomQuestion()"
                            ${appState.isLoading ? 'disabled' : ''}
                            class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors disabled:bg-gray-400"
                        >
                            M√°sik k√©rd√©s
                        </button>
                    </div>

                    ${appState.errorMessage ? `
                    <div class="p-4 bg-red-50 border-2 border-red-300 rounded-xl">
                        <pre class="text-sm text-red-700 whitespace-pre-wrap">${appState.errorMessage}</pre>
                    </div>
                    ` : ''}
                    ` : `
                    <!-- Eredm√©ny -->
                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-xl p-4">
                            <p class="text-sm font-medium text-gray-600 mb-2">A te v√°laszod:</p>
                            <p class="text-gray-700 italic">"${appState.userAnswer}"</p>
                        </div>

                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white text-center">
                            <p class="text-lg mb-2">Pontsz√°m</p>
                            <p class="text-6xl font-bold">${appState.evaluation.pontszam}/10</p>
                        </div>

                        <div class="bg-blue-50 rounded-xl p-6">
                            <h3 class="font-semibold text-lg text-blue-900 mb-3">√ârt√©kel√©s</h3>
                            <p class="text-gray-700">${appState.evaluation.visszajelzes}</p>
                        </div>

                        ${appState.evaluation.hianyossagok && appState.evaluation.hianyossagok.length > 0 && appState.evaluation.hianyossagok[0] !== "" ? `
                        <div class="bg-amber-50 rounded-xl p-6">
                            <h3 class="font-semibold text-lg text-amber-900 mb-3">Mit lehetne jav√≠tani</h3>
                            <ul class="space-y-2">
                                ${appState.evaluation.hianyossagok.map(h => `
                                <li class="text-gray-700 flex gap-2">
                                    <span class="text-amber-600">‚Ä¢</span>
                                    <span>${h}</span>
                                </li>
                                `).join('')}
                            </ul>
                        </div>
                        ` : ''}

                        ${appState.evaluation.dicseret ? `
                        <div class="bg-green-50 rounded-xl p-6">
                            <h3 class="font-semibold text-lg text-green-900 mb-3">J√≥l csin√°ltad</h3>
                            <p class="text-gray-700">${appState.evaluation.dicseret}</p>
                        </div>
                        ` : ''}

                        <button
                            onclick="selectRandomQuestion()"
                            class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-6 rounded-xl transition-all"
                        >
                            K√∂vetkez≈ë k√©rd√©s ‚Üí
                        </button>
                    </div>
                    `}
                </div>

                <div class="mt-6 text-center text-sm text-gray-600">
                    <p>üåç F√∂ldrajz kv√≠z gyakorl√°s ‚Ä¢ Tanul√°s m√≥d</p>
                </div>
            </div>
        </div>
    `;
}

function renderTestMode() {
    if (!appState.testCompleted) {
        const currentQ = appState.testQuestions[appState.currentTestIndex];
        const progress = Math.round(((appState.currentTestIndex + (appState.evaluation ? 1 : 0)) / appState.testQuestions.length) * 100);
        
        return `
            <div class="min-h-screen p-6">
                <div class="max-w-3xl mx-auto">
                    <!-- M√≥d v√°lt√≥ gombok -->
                    <div class="mb-4 flex gap-3">
                        <button
                            onclick="switchMode('tanulas')"
                            class="flex-1 bg-white text-indigo-600 border-2 border-indigo-600 font-semibold py-3 px-6 rounded-xl hover:bg-indigo-50"
                        >
                            üìö Tanul√°s m√≥d
                        </button>
                        <button
                            onclick="switchMode('teszt')"
                            class="flex-1 bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl"
                        >
                            üéØ Teszt m√≥d
                        </button>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <!-- Fejl√©c -->
                        <div class="mb-6">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Teszt m√≥d</h1>
                            <p class="text-sm text-gray-500">${appState.currentTestIndex + 1}/5 k√©rd√©s</p>
                            
                            <!-- Progress bar -->
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden mt-3">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-3 rounded-full transition-all duration-500" 
                                     style="width: ${progress}%">
                                </div>
                            </div>
                        </div>

                        <!-- K√©rd√©s -->
                        <div class="bg-green-50 rounded-xl p-6 mb-6">
                            <h2 class="text-xl font-semibold text-green-900 mb-3">K√©rd√©s ${appState.currentTestIndex + 1}:</h2>
                            <p class="text-lg text-gray-700">${currentQ.question}</p>
                            
                            ${appState.revealedKeywords.length > 0 ? `
                            <div class="mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg">
                                <p class="text-sm font-semibold text-yellow-900 mb-1">üí° Seg√≠ts√©g (-${appState.hintsUsed * 2} pont):</p>
                                <p class="text-sm text-yellow-800">${appState.revealedKeywords.join(', ')}</p>
                            </div>
                            ` : ''}
                        </div>

                        ${!appState.evaluation ? `
                        <!-- V√°lasz mez≈ë -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">A te v√°laszod:</label>
                            <textarea
                                id="userAnswerInput"
                                oninput="appState.userAnswer = this.value"
                                class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none resize-none"
                                placeholder="√çrd ide a v√°laszodat..."
                                ${appState.isLoading ? 'disabled' : ''}
                            >${appState.userAnswer}</textarea>
                        </div>

                        <!-- Gombok -->
                        <div class="flex gap-3">
                            <button
                                onclick="submitTestAnswer()"
                                ${appState.isLoading ? 'disabled' : ''}
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors disabled:bg-gray-400"
                            >
                                ${appState.isLoading ? '√ârt√©kel√©s...' : 'V√°lasz bek√ºld√©se'}
                            </button>
                            <button
                                onclick="requestTestHint()"
                                ${appState.isLoading ? 'disabled' : ''}
                                class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors disabled:bg-gray-400"
                            >
                                üí° Seg√≠ts√©g
                            </button>
                        </div>

                        ${appState.errorMessage ? `
                        <div class="mt-4 p-4 bg-red-50 border-2 border-red-300 rounded-xl">
                            <pre class="text-sm text-red-700 whitespace-pre-wrap">${appState.errorMessage}</pre>
                        </div>
                        ` : ''}
                        ` : `
                        <!-- Eredm√©ny -->
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-xl p-4">
                                <p class="text-sm font-medium text-gray-600 mb-2">A te v√°laszod:</p>
                                <p class="text-gray-700 italic">"${appState.userAnswer}"</p>
                            </div>

                            <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-6 text-white text-center">
                                <p class="text-lg mb-2">Pontsz√°m</p>
                                <p class="text-6xl font-bold">${appState.evaluation.pontszam}/10</p>
                            </div>

                            <div class="bg-blue-50 rounded-xl p-6">
                                <p class="text-gray-700">${appState.evaluation.visszajelzes}</p>
                            </div>

                            ${appState.evaluation.hianyossagok && appState.evaluation.hianyossagok.length > 0 && appState.evaluation.hianyossagok[0] !== "" ? `
                            <div class="bg-amber-50 rounded-xl p-6">
                                <h3 class="font-semibold text-lg text-amber-900 mb-3">Mit lehetne jav√≠tani</h3>
                                <ul class="space-y-2">
                                    ${appState.evaluation.hianyossagok.map(h => `
                                    <li class="text-gray-700 flex gap-2">
                                        <span class="text-amber-600">‚Ä¢</span>
                                        <span>${h}</span>
                                    </li>
                                    `).join('')}
                                </ul>
                            </div>
                            ` : ''}

                            <button
                                onclick="nextTestQuestion()"
                                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-6 rounded-xl transition-all"
                            >
                                ${appState.currentTestIndex + 1 < appState.testQuestions.length ? 'K√∂vetkez≈ë k√©rd√©s ‚Üí' : 'Teszt befejez√©se ‚Üí'}
                            </button>
                        </div>
                        `}
                    </div>
                </div>
            </div>
        `;
    } else {
        const passed = appState.testScore >= 90;
        
        return `
            <div class="min-h-screen p-6">
                <div class="max-w-3xl mx-auto">
                    <!-- M√≥d v√°lt√≥ gombok -->
                    <div class="mb-4 flex gap-3">
                        <button
                            onclick="switchMode('tanulas')"
                            class="flex-1 bg-white text-indigo-600 border-2 border-indigo-600 font-semibold py-3 px-6 rounded-xl hover:bg-indigo-50"
                        >
                            üìö Tanul√°s m√≥d
                        </button>
                        <button
                            onclick="startTest()"
                            class="flex-1 bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-indigo-700"
                        >
                            üîÑ √öj teszt
                        </button>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Teszt eredm√©nye</h1>
                        
                        <!-- Eredm√©ny k√°rtya -->
                        <div class="bg-gradient-to-r ${passed ? 'from-green-500 to-emerald-600' : 'from-red-500 to-orange-600'} rounded-xl p-8 text-white text-center mb-6">
                            <p class="text-xl mb-2">${passed ? 'üéâ Sikeres teszt!' : 'üìö Gyakorolj m√©g!'}</p>
                            <p class="text-7xl font-bold mb-2">${appState.testScore}%</p>
                            <p class="text-lg">5 k√©rd√©sb≈ël ${appState.testAnswers.reduce((sum, ans) => sum + ans.evaluation.pontszam, 0)}/50 pont</p>
                        </div>

                        ${passed ? `
                        <!-- Tan√∫s√≠tv√°ny let√∂lt√©s -->
                        <div class="bg-green-50 rounded-xl p-6 mb-6">
                            <h3 class="font-semibold text-lg text-green-900 mb-3 text-center">üèÜ Gratul√°lunk! Let√∂ltheted a tan√∫s√≠tv√°nyt!</h3>
                            
                            ${appState.certificateDownloaded ? `
                            <!-- M√°r let√∂ltve -->
                            <div class="bg-green-100 border-2 border-green-500 rounded-xl p-4 mb-4 text-center">
                                <p class="text-green-800 font-semibold text-lg">‚úÖ Tan√∫s√≠tv√°ny sikeresen let√∂ltve!</p>
                                <p class="text-green-700 text-sm mt-2">√öj teszt ind√≠t√°s√°hoz kattints a fenti gombra.</p>
                            </div>
                            ` : `
                            <!-- M√©g nem t√∂lt√∂tte le -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Add meg a neved:</label>
                                <input
                                    type="text"
                                    id="userNameInput"
                                    oninput="appState.testUserName = this.value"
                                    value="${appState.testUserName}"
                                    class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none"
                                    placeholder="Teljes n√©v"
                                />
                            </div>
                            <button
                                onclick="generateCertificate()"
                                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-6 rounded-xl transition-all"
                            >
                                üì• Tan√∫s√≠tv√°ny let√∂lt√©se (PNG)
                            </button>
                            `}
                        </div>
                        ` : ''}

                        <!-- R√©szletes eredm√©nyek -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-lg text-gray-800">R√©szletes eredm√©nyek:</h3>
                            ${appState.testAnswers.map((ans, idx) => `
                            <div class="bg-gray-50 rounded-xl p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="font-semibold text-gray-800">${idx + 1}. ${ans.question.question}</p>
                                    <span class="text-lg font-bold ${ans.evaluation.pontszam >= 8 ? 'text-green-600' : ans.evaluation.pontszam >= 5 ? 'text-yellow-600' : 'text-red-600'}">${ans.evaluation.pontszam}/10</span>
                                </div>
                                <p class="text-sm text-gray-600 italic mb-2">"${ans.userAnswer}"</p>
                                <p class="text-sm text-gray-700">${ans.evaluation.visszajelzes}</p>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
}

// Ind√≠t√°s
window.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ F√∂ldrajz Kv√≠z ind√≠t√°sa...');
    render();
    loadQuestionsFromCSV();
});
</script>

</body>
</html>